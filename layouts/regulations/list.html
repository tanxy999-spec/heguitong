{{ define "main" }}
<link rel="stylesheet" href="/css/styles.css">
<!-- 面包屑导航已删除 -->
<!-- 核心内容区 -->
<main class="container mx-auto px-4 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- 左侧主栏 -->
        <div class="lg:col-span-2 space-y-6">
            <!-- 页面标题 - Banner -->
            <div class="relative bg-gradient-to-r from-primary to-red-800 text-white rounded-md p-6 overflow-hidden">
                <div class="relative z-10">
                    <h2 class="text-2xl font-bold mb-2">法规政策</h2>
                    <p class="text-white text-opacity-90">全面收录慈善领域相关法规政策，助力组织合规运营</p>
                </div>
                <div class="absolute top-0 right-0 opacity-10">
                    <i class="fa fa-book" style="font-size: 120px;"></i>
                </div>
            </div>
            

            
            <!-- 法规列表 -->
            <div class="space-y-4" id="regulationList">
                {{/* 定义30天前的日期用于判断最新法规 */}}
                {{ $thirtyDaysAgo := (now.AddDate 0 0 -30) }}
                
                {{/* 按日期降序排序所有法规 */}}
                {{ $sortedRegulations := (where .Site.RegularPages "Section" "regulations").ByDate.Reverse }}
                
                {{/* 遍历所有法规 */}}
                {{ range $sortedRegulations }}
                    {{/* 确定法规类别 */}}
                    {{ $category := "" }}
                    {{ if in .Params.categories "国家法规" }}
                        {{ $category = "national" }}
                    {{ else if in .Params.categories "地方政策" }}
                        {{ $category = "local" }}
                    {{ else if in .Params.categories "政策解读" }}
                        {{ $category = "interpretations" }}
                    {{ end }}
                    
                    {{/* 检查是否为最新法规（30天内发布） */}}
                    {{ $isLatest := false }}
                    {{ if ge .Date $thirtyDaysAgo }}
                        {{ $isLatest = true }}
                    {{ end }}
                    
                    {{/* 设置data-category属性值 */}}
                    {{ $dataCategory := $category }}
                    {{ if $isLatest }}
                        {{ $dataCategory = printf "%s latest" $category }}
                    {{ end }}
                    
                    <!-- 法规卡片 -->
                    <div class="regulation-card bg-white p-6 border border-gray-300 rounded-md hover:border-gray-400 hover:shadow-md transition-all duration-300" data-category="{{ $dataCategory }}">
                        <div class="flex flex-col md:flex-row md:items-center justify-between">
                            <div class="flex-1 mb-3 md:mb-0">
                                <h3 class="text-lg font-semibold text-primary mb-1">
                                    <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                                </h3>
                                <div class="flex gap-2 mb-2">
                                    {{ if $isLatest }}
                                        <span class="inline-block px-2 py-0.5 bg-primary text-white text-xs rounded">最新</span>
                                    {{ end }}
                                    {{ if eq $category "national" }}
                                        <span class="inline-flex items-center px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded">
                                            <i class="fa fa-tag mr-1"></i>国家法规
                                        </span>
                                    {{ else if eq $category "local" }}
                                        <span class="inline-flex items-center px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded">
                                            <i class="fa fa-tag mr-1"></i>地方政策
                                        </span>
                                    {{ else if eq $category "interpretations" }}
                                        <span class="inline-flex items-center px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs rounded">
                                            <i class="fa fa-tag mr-1"></i>政策解读
                                        </span>
                                    {{ end }}
                                </div>
                                <p class="text-gray-600 text-sm mb-2 line-clamp-2">{{ .Params.description | default "暂无描述" }}</p>
                                <div class="flex items-center text-sm text-gray-500">
                                    <span><i class="fa fa-calendar mr-1"></i> {{ .Date.Format "2006-01-02" }}</span>
                                </div>
                            </div>
                            <div class="md:ml-4">
                                <a href="{{ .RelPermalink }}" class="px-3 py-1 bg-lightGray hover:bg-primary hover:text-white text-sm rounded transition-colors">
                                    查看详情
                                </a>
                            </div>
                        </div>
                    </div>
                {{ end }}
            </div>
            
            <!-- 分页 -->
            <div class="mt-8 flex justify-center">
                <nav class="inline-flex rounded-md shadow">
                    <a href="#" class="px-3 py-2 border border-gray-300 text-sm font-medium rounded-l-md text-gray-500 bg-white hover:bg-gray-50" data-category="all" data-page="prev">
                        <span class="sr-only">上一页</span>
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 text-sm font-medium text-white bg-primary" data-category="all" data-page="1">1</a>
                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" data-category="all" data-page="2">2</a>
                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" data-category="all" data-page="3">3</a>
                    <span class="px-3 py-2 border-t border-b border-gray-300 text-sm font-medium text-gray-700 bg-white">...</span>
                    <a href="#" class="px-3 py-2 border-t border-b border-gray-300 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50" data-category="all" data-page="10">10</a>
                    <a href="#" class="px-3 py-2 border border-gray-300 text-sm font-medium rounded-r-md text-gray-500 bg-white hover:bg-gray-50" data-category="all" data-page="next">
                        <span class="sr-only">下一页</span>
                        <i class="fa fa-angle-right"></i>
                    </a>
                </nav>
            </div>
        </div>
        
        <!-- 右侧边栏 -->
        <div class="space-y-6">
            <!-- 热门法规 -->
            <div class="bg-white border border-darkGray rounded-md">
                <div class="border-b border-darkGray px-6 py-3 bg-lightGray">
                    <h3 class="text-lg font-semibold text-neutral">热门法规</h3>
                </div>
                <div class="p-6">
                    <ul class="space-y-4">
                        <li class="relative pl-6">
                            <span class="absolute left-0 top-0 bg-primary text-white w-5 h-5 flex items-center justify-center rounded-full text-xs">1</span>
                            <a href="#" class="text-neutral hover:text-primary line-clamp-2">《中华人民共和国慈善法》</a>
                        </li>
                        <li class="relative pl-6">
                            <span class="absolute left-0 top-0 bg-primary text-white w-5 h-5 flex items-center justify-center rounded-full text-xs">2</span>
                            <a href="/regulations/charity-info-disclosure-detail/" class="text-neutral hover:text-primary line-clamp-2">《慈善组织信息公开办法》2025修订版</a>
                        </li>
                        <li class="relative pl-6">
                            <span class="absolute left-0 top-0 bg-primary text-white w-5 h-5 flex items-center justify-center rounded-full text-xs">3</span>
                            <a href="#" class="text-neutral hover:text-primary line-clamp-2">《慈善组织保值增值投资活动管理暂行办法》</a>
                        </li>
                        <li class="relative pl-6">
                            <span class="absolute left-0 top-0 bg-gray-300 text-gray-700 w-5 h-5 flex items-center justify-center rounded-full text-xs">4</span>
                            <a href="#" class="text-neutral hover:text-primary line-clamp-2">《慈善组织认定办法》</a>
                        </li>
                        <li class="relative pl-6">
                            <span class="absolute left-0 top-0 bg-gray-300 text-gray-700 w-5 h-5 flex items-center justify-center rounded-full text-xs">5</span>
                            <a href="#" class="text-neutral hover:text-primary line-clamp-2">《社会组织评估管理办法》</a>
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- 咨询服务 -->
            <div class="bg-lightGray border border-darkGray rounded-md">
                <div class="p-6">
                    <h3 class="text-lg font-semibold text-neutral mb-4">法规咨询</h3>
                    <p class="text-gray-600 text-sm mb-4">对法规政策有疑问？我们的专业团队为您提供一对一解答</p>
                    <button class="w-full bg-primary hover:bg-red-700 text-white py-3 rounded-md font-semibold transition-colors">
                        立即咨询
                    </button>
                    <div class="text-center mt-4 text-sm text-gray-500">
                        <i class="fa fa-phone mr-1"></i> 400-888-9999
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

  <!-- 分类切换JavaScript -->
  <script>
    console.log('法规页面JavaScript加载');
    
    // 等待DOM完全加载
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM已加载，初始化分页功能');
      
      // 获取法规列表容器
      const regulationList = document.getElementById('regulationList');
      
      // 保存原始法规卡片（Hugo渲染的真实数据）
      const originalCards = Array.from(document.querySelectorAll('.regulation-card'));
      
      console.log(`保存了 ${originalCards.length} 个原始法规卡片`);
      
      // 法规分页逻辑
      // 获取所有分页导航元素
      const paginationLinks = document.querySelectorAll('.mt-8.flex.justify-center a[data-page]');
      
      // 为所有分页链接添加点击事件
      paginationLinks.forEach(link => {
          link.addEventListener('click', function(e) {
              e.preventDefault();
              
              const page = this.getAttribute('data-page');
              console.log(`点击了页码: ${page}`);
              
              // 更新分页状态
              updatePaginationStatus(page);
              
              // 加载指定页法规
              loadPage(page);
          });
      });
      
      // 更新分页状态函数
      function updatePaginationStatus(targetPage) {
          // 获取所有页码链接（排除上一页和下一页）
          const pageLinks = Array.from(paginationLinks).filter(link => 
              !isNaN(link.getAttribute('data-page')) && 
              link.getAttribute('data-page') !== 'prev' && 
              link.getAttribute('data-page') !== 'next'
          );
          
          // 获取所有页码值
          const allPages = pageLinks.map(link => link.getAttribute('data-page'));
          
          let newPage = targetPage;
          
          // 处理上一页和下一页
          if (targetPage === 'prev') {
              // 获取当前活动页码
              const activeLink = document.querySelector('.mt-8.flex.justify-center a.bg-primary');
              const activePage = activeLink ? activeLink.getAttribute('data-page') : '1';
              const activeIndex = allPages.indexOf(activePage);
              newPage = activeIndex > 0 ? allPages[activeIndex - 1] : allPages[0];
          } else if (targetPage === 'next') {
              // 获取当前活动页码
              const activeLink = document.querySelector('.mt-8.flex.justify-center a.bg-primary');
              const activePage = activeLink ? activeLink.getAttribute('data-page') : '1';
              const activeIndex = allPages.indexOf(activePage);
              newPage = activeIndex < allPages.length - 1 ? allPages[activeIndex + 1] : allPages[allPages.length - 1];
          }
          
          console.log(`更新到页码: ${newPage}`);
          
          // 移除所有活动状态
          pageLinks.forEach(link => {
              link.classList.remove('bg-primary', 'text-white');
              link.classList.add('bg-white', 'text-gray-700');
          });
          
          // 设置目标页码为活动状态
          const targetLink = pageLinks.find(link => link.getAttribute('data-page') === newPage);
          if (targetLink) {
              targetLink.classList.remove('bg-white', 'text-gray-700');
              targetLink.classList.add('bg-primary', 'text-white');
          }
          
          return newPage;
      }
      
      // 加载页面数据函数 - 基于原始法规卡片实现分页
      function loadPage(page) {
          console.log(`加载第${page}页法规`);
          
          // 添加加载提示
          regulationList.innerHTML = '<div class="text-center py-8"><i class="fa fa-spinner fa-spin text-primary text-2xl"></i><p class="mt-2">加载中...</p></div>';
          
          // 确保使用正确的页码
          const pageLinks = Array.from(paginationLinks).filter(link => 
              !isNaN(link.getAttribute('data-page')) && 
              link.getAttribute('data-page') !== 'prev' && 
              link.getAttribute('data-page') !== 'next'
          );
          const allPages = pageLinks.map(link => link.getAttribute('data-page'));
          
          let pageNum;
          if (page === 'prev' || page === 'next') {
              // 找到当前活动页
              const activeLink = document.querySelector('.mt-8.flex.justify-center a.bg-primary');
              pageNum = activeLink ? parseInt(activeLink.getAttribute('data-page')) : 1;
          } else {
              pageNum = parseInt(page);
          }
          
          // 设置每页显示的法规数量
          const itemsPerPage = 5;
          
          // 计算当前页应该显示的卡片索引范围
          const startIndex = (pageNum - 1) * itemsPerPage;
          const endIndex = startIndex + itemsPerPage;
          
          // 获取当前页应该显示的卡片
          const currentPageCards = originalCards.slice(startIndex, endIndex);
          
          console.log(`显示第 ${startIndex + 1} 到 ${endIndex} 个法规卡片`);
          
          // 模拟网络延迟
          setTimeout(() => {
              // 清空列表容器
              regulationList.innerHTML = '';
              
              // 如果没有更多卡片，显示提示信息
              if (currentPageCards.length === 0) {
                  regulationList.innerHTML = '<div class="text-center py-8 text-gray-500">没有更多法规内容了</div>';
              } else {
                  // 将当前页的卡片添加到列表中
                  currentPageCards.forEach(card => {
                      regulationList.appendChild(card.cloneNode(true));
                  });
              }
          }, 300);
      }
    });
  </script>
{{ end }}